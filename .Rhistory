J.series[[i]] <- 1:365
}
}
#Note that small deviations might happen in leap years due to J_max = 366.
radiation_atmosphere<- data.frame(J = unlist(J.series))
radiation_atmosphere$dr <- 1 + 0.033*cos(2*pi*radiation_atmosphere$J/365)
radiation_atmosphere$delta <- 0.4093*sin(2*pi*radiation_atmosphere$J/365  - 1.405)
radiation_atmosphere$ws <- acos(-tan(my_lat)*tan(radiation_atmosphere$delta))
radiation_atmosphere$ra <- 15.392 * radiation_atmosphere$dr * (radiation_atmosphere$ws * sin(my_lat) * sin(radiation_atmosphere$delta) + cos(my_lat) * cos(radiation_atmosphere$delta) * sin(radiation_atmosphere$ws))
et0 <- temperature.mean
et0$et <- 0.0023*radiation_atmosphere$ra*
(temperature.max$max - temperature.min$min)*(temperature.mean$mean + 17.8)
et0 <- et0[,c(1,3)]
plot(et0, type = 'l')
# Function to arrange data in list of years
f.year <- function(i,year.var,day.var){
year.var$i <- filter(day.var, day.var$year == i)
}
#define a column of years and reload start and end of series
et0$year <- year(et0$time)
beg <- min(et0$year) #year of the series beginning
end <- max(et0$year)
year.et0 <- NULL
#organize years in separated lists
year.et0 <- lapply(beg:end,f.year, year.et0, et0)
n.years <- length(year.et0)
#Collapse data on each year (element of the list) into pentads
pentad.et0 <- NULL
for (i in 1:n.years){
year.var <- year.et0[[i]][1:2]
year.var <- tibble::tibble(time = as.POSIXct(year.var[,1]),
value = year.var[,2]) %>% as_tbl_time(time)
pentad.var <- collapse_by(year.var, period = '5 days')
pentad.var <- pentad.var %>% group_by(time) %>%
summarise(et0 = mean(.data[["et"]]))
#in leap years, the last pentad has 6 days
if (nrow(pentad.var) == 74){
pentad.var$et0[73] <- (pentad.var$et0[73]*5 + pentad.var$et0[74])/6
}
pentad.et0 <- cbind(pentad.et0,pentad.var$et0)
}
year.et0
#Collapse data on each year (element of the list) into pentads
pentad.et0 <- NULL
for (i in 1:n.years){
year.var <- year.et0[[i]][1:2]
year.var <- tibble::tibble(time = as.POSIXct(year.var[,1], tz = 'GTM'),
value = year.var[,2]) %>% as_tbl_time(time)
pentad.var <- collapse_by(year.var, period = '5 days')
pentad.var <- pentad.var %>% group_by(time) %>%
summarise(et0 = mean(.data[["et"]]))
#in leap years, the last pentad has 6 days
if (nrow(pentad.var) == 74){
pentad.var$et0[73] <- (pentad.var$et0[73]*5 + pentad.var$et0[74])/6
}
pentad.et0 <- cbind(pentad.et0,pentad.var$et0)
}
for (i in 1:n.years){
year.var <- year.et0[[i]][1:2]
year.var <- tibble::tibble(time = as.POSIXct(year.var[,1], tz = 'GMT'),
value = year.var[,2]) %>% as_tbl_time(time)
pentad.var <- collapse_by(year.var, period = '5 days')
pentad.var <- pentad.var %>% group_by(time) %>%
summarise(et0 = mean(.data[["et"]]))
#in leap years, the last pentad has 6 days
if (nrow(pentad.var) == 74){
pentad.var$et0[73] <- (pentad.var$et0[73]*5 + pentad.var$et0[74])/6
}
pentad.et0 <- cbind(pentad.et0,pentad.var$et0)
}
#Collapse data on each year (element of the list) into pentads
pentad.et0 <- NULL
for (i in 1:n.years){
year.var <- year.et0[[i]][1:2]
year.var <- tibble::tibble(time = as.POSIXct(as.numeric(year.var[,1])),
value = year.var[,2]) %>% as_tbl_time(time)
pentad.var <- collapse_by(year.var, period = '5 days')
pentad.var <- pentad.var %>% group_by(time) %>%
summarise(et0 = mean(.data[["et"]]))
#in leap years, the last pentad has 6 days
if (nrow(pentad.var) == 74){
pentad.var$et0[73] <- (pentad.var$et0[73]*5 + pentad.var$et0[74])/6
}
pentad.et0 <- cbind(pentad.et0,pentad.var$et0)
}
for (i in 1:n.years){
year.var <- year.et0[[i]][1:2]
year.var <- tibble::tibble(time = as.numeric(as.POSIXct(year.var[,1])),
value = year.var[,2]) %>% as_tbl_time(time)
pentad.var <- collapse_by(year.var, period = '5 days')
pentad.var <- pentad.var %>% group_by(time) %>%
summarise(et0 = mean(.data[["et"]]))
#in leap years, the last pentad has 6 days
if (nrow(pentad.var) == 74){
pentad.var$et0[73] <- (pentad.var$et0[73]*5 + pentad.var$et0[74])/6
}
pentad.et0 <- cbind(pentad.et0,pentad.var$et0)
}
year.var <- tibble::tibble(time = as.POSIXct(as.Date(year.var[,1])),
value = year.var[,2]) %>% as_tbl_time(time)
#Collapse data on each year (element of the list) into pentads
pentad.et0 <- NULL
for (i in 1:n.years){
year.var <- year.et0[[i]][1:2]
year.var <- tibble::tibble(time = as.POSIXct(as.Date(year.var[,1])),
value = year.var[,2]) %>% as_tbl_time(time)
pentad.var <- collapse_by(year.var, period = '5 days')
pentad.var <- pentad.var %>% group_by(time) %>%
summarise(et0 = mean(.data[["et"]]))
#in leap years, the last pentad has 6 days
if (nrow(pentad.var) == 74){
pentad.var$et0[73] <- (pentad.var$et0[73]*5 + pentad.var$et0[74])/6
}
pentad.et0 <- cbind(pentad.et0,pentad.var$et0)
}
year.var <- tibble::tibble(time = as.POSIXct(as.character(year.var[,1])),
value = year.var[,2]) %>% as_tbl_time(time)
#Collapse data on each year (element of the list) into pentads
pentad.et0 <- NULL
for (i in 1:n.years){
year.var <- year.et0[[i]][1:2]
year.var <- tibble::tibble(time = as.POSIXct(as.character(year.var[,1])),
value = year.var[,2]) %>% as_tbl_time(time)
pentad.var <- collapse_by(year.var, period = '5 days')
pentad.var <- pentad.var %>% group_by(time) %>%
summarise(et0 = mean(.data[["et"]]))
#in leap years, the last pentad has 6 days
if (nrow(pentad.var) == 74){
pentad.var$et0[73] <- (pentad.var$et0[73]*5 + pentad.var$et0[74])/6
}
pentad.et0 <- cbind(pentad.et0,pentad.var$et0)
}
as.character(year.var[,1])
#Collapse data on each year (element of the list) into pentads
pentad.et0 <- NULL
for (i in 1:n.years){
year.var <- year.et0[[i]][1:2]
year.var <- tibble::tibble(time = as.POSIXct(unlist(year.var[,1])),
value = year.var[,2]) %>% as_tbl_time(time)
pentad.var <- collapse_by(year.var, period = '5 days')
pentad.var <- pentad.var %>% group_by(time) %>%
summarise(et0 = mean(.data[["et"]]))
#in leap years, the last pentad has 6 days
if (nrow(pentad.var) == 74){
pentad.var$et0[73] <- (pentad.var$et0[73]*5 + pentad.var$et0[74])/6
}
pentad.et0 <- cbind(pentad.et0,pentad.var$et0)
}
unlist(year.var[,1])
#Collapse data on each year (element of the list) into pentads
pentad.et0 <- NULL
for (i in 1:n.years){
year.var <- year.et0[[i]][1:2]
year.var <- tibble::tibble(time = as.POSIXct(unlist(year.var[,1]), origin = '1970-01-01'),
value = year.var[,2]) %>% as_tbl_time(time)
pentad.var <- collapse_by(year.var, period = '5 days')
pentad.var <- pentad.var %>% group_by(time) %>%
summarise(et0 = mean(.data[["et"]]))
#in leap years, the last pentad has 6 days
if (nrow(pentad.var) == 74){
pentad.var$et0[73] <- (pentad.var$et0[73]*5 + pentad.var$et0[74])/6
}
pentad.et0 <- cbind(pentad.et0,pentad.var$et0)
}
#Collapse data on each year (element of the list) into pentads
pentad.et0 <- NULL
for (i in 1:n.years){
year.var <- year.et0[[i]][1:2]
year.var <- tibble::tibble(time = as.POSIXct(unlist(year.var[,1])/86400, origin = '1970-01-01'),
value = year.var[,2]) %>% as_tbl_time(time)
pentad.var <- collapse_by(year.var, period = '5 days')
pentad.var <- pentad.var %>% group_by(time) %>%
summarise(et0 = mean(.data[["et"]]))
#in leap years, the last pentad has 6 days
if (nrow(pentad.var) == 74){
pentad.var$et0[73] <- (pentad.var$et0[73]*5 + pentad.var$et0[74])/6
}
pentad.et0 <- cbind(pentad.et0,pentad.var$et0)
}
year.var <- tibble::tibble(time = as.POSIXct((year.var[,1])),
value = year.var[,2]) %>% as_tbl_time(time)
class(year.var[,1])
year.var <- tibble::tibble(time = as.POSIXct(as.data.frame(year.var[,1])),
value = year.var[,2]) %>% as_tbl_time(time)
for (i in 1:n.years){
year.var <- year.et0[[i]][1:2]
year.var <- tibble::tibble(time = as.POSIXct(as.data.frame(year.var[,1])),
value = year.var[,2]) %>% as_tbl_time(time)
pentad.var <- collapse_by(year.var, period = '5 days')
pentad.var <- pentad.var %>% group_by(time) %>%
summarise(et0 = mean(.data[["et"]]))
#in leap years, the last pentad has 6 days
if (nrow(pentad.var) == 74){
pentad.var$et0[73] <- (pentad.var$et0[73]*5 + pentad.var$et0[74])/6
}
pentad.et0 <- cbind(pentad.et0,pentad.var$et0)
}
#Collapse data on each year (element of the list) into pentads
pentad.et0 <- NULL
for (i in 1:n.years){
year.var <- year.et0[[i]][1:2]
year.var <- tibble::tibble(time = as.POSIXct(as.matrix(year.var[,1])),
value = year.var[,2]) %>% as_tbl_time(time)
pentad.var <- collapse_by(year.var, period = '5 days')
pentad.var <- pentad.var %>% group_by(time) %>%
summarise(et0 = mean(.data[["et"]]))
#in leap years, the last pentad has 6 days
if (nrow(pentad.var) == 74){
pentad.var$et0[73] <- (pentad.var$et0[73]*5 + pentad.var$et0[74])/6
}
pentad.et0 <- cbind(pentad.et0,pentad.var$et0)
}
et0
et0$date <- as.Date(et0$time)
et0
et0$time <- as.Date(et0$time)
et0
# get ET0 daily from Hargreaves equation
et0 <- temperature.mean
et0$et <- 0.0023*radiation_atmosphere$ra*
(temperature.max$max - temperature.min$min)*(temperature.mean$mean + 17.8)
et0 <- et0[,c(1,3)]
# Function to arrange data in list of years
f.year <- function(i,year.var,day.var){
year.var$i <- filter(day.var, day.var$year == i)
}
et0$time <- as.Date(et0$time)
et0
#define a column of years and reload start and end of series
et0$year <- year(et0$time)
beg <- min(et0$year) #year of the series beginning
end <- max(et0$year)
year.et0 <- NULL
#organize years in separated lists
year.et0 <- lapply(beg:end,f.year, year.et0, et0)
n.years <- length(year.et0)
#Collapse data on each year (element of the list) into pentads
pentad.et0 <- NULL
for (i in 1:n.years){
year.var <- year.et0[[i]][1:2]
year.var <- tibble::tibble(time = as.POSIXct(as.matrix(year.var[,1])),
value = year.var[,2]) %>% as_tbl_time(time)
pentad.var <- collapse_by(year.var, period = '5 days')
pentad.var <- pentad.var %>% group_by(time) %>%
summarise(et0 = mean(.data[["et"]]))
#in leap years, the last pentad has 6 days
if (nrow(pentad.var) == 74){
pentad.var$et0[73] <- (pentad.var$et0[73]*5 + pentad.var$et0[74])/6
}
pentad.et0 <- cbind(pentad.et0,pentad.var$et0)
}
#Collapse data on each year (element of the list) into pentads
pentad.et0 <- NULL
for (i in 1:n.years){
year.var <- year.et0[[i]][1:2]
year.var <- tibble::tibble(time = as.POSIXct(year.var[,1]),
value = year.var[,2]) %>% as_tbl_time(time)
pentad.var <- collapse_by(year.var, period = '5 days')
pentad.var <- pentad.var %>% group_by(time) %>%
summarise(et0 = mean(.data[["et"]]))
#in leap years, the last pentad has 6 days
if (nrow(pentad.var) == 74){
pentad.var$et0[73] <- (pentad.var$et0[73]*5 + pentad.var$et0[74])/6
}
pentad.et0 <- cbind(pentad.et0,pentad.var$et0)
}
year.var[,1]
et0
as.numeric(year.var[,1])
as.character(year.var[,1])
year.var <- tibble::tibble(time = as.POSIXct(as.character(year.var[,1])),
value = year.var[,2]) %>% as_tbl_time(time)
#Collapse data on each year (element of the list) into pentads
pentad.et0 <- NULL
for (i in 1:n.years){
year.var <- year.et0[[i]][1:2]
year.var <- tibble::tibble(time = as.POSIXct(as.character(year.var[,1])),
value = year.var[,2]) %>% as_tbl_time(time)
pentad.var <- collapse_by(year.var, period = '5 days')
pentad.var <- pentad.var %>% group_by(time) %>%
summarise(et0 = mean(.data[["et"]]))
#in leap years, the last pentad has 6 days
if (nrow(pentad.var) == 74){
pentad.var$et0[73] <- (pentad.var$et0[73]*5 + pentad.var$et0[74])/6
}
pentad.et0 <- cbind(pentad.et0,pentad.var$et0)
}
de.tha <- read.csv('FLX_DE-Tha_FLUXNET2015_SUBSET_DD_1996-2014_1-4.csv')
df1 <- de.tha
swc <- df1[,c('TIMESTAMP','SWC_F_MDS_1')] # get columns of interest. Column names according to Pastorello 2020
swc$TIMESTAMP <- ymd(swc$TIMESTAMP) # coerce column of times to Date format
swc <- na_if(swc,-9999)
colnames(swc) <- c('time', 'swc')
swc
# Function to arrange data in list of years
f.year <- function(i,day.var,year.var=NULL){
year.var$i <- filter(day.var, day.var$year == i)
return(year.var$i)
}
#define a column of years and get start and end of series
swc$year <- year(swc$time)
beg <- min(swc$year) #year of the series beginning
end <- max(swc$year)
#organize years in separated lists
year.swc <- lapply(beg:end,f.year, swc)
# View(year.swc)
n.years <- length(year.swc)
swc
beg <- min(swc$year) #year of the series beginning
end <- max(swc$year)
#organize years in separated lists
year.swc <- lapply(beg:end,f.year, swc)
#Collapse data on each year (element of the list) into pentads
pentad.swc <- NULL
pentad.swc.series <- NULL
for (i in 1:n.years){
year.var <- year.swc[[i]][1:2]
year.var <- tibble::tibble(time = as.POSIXct(year.var[,1]),
value = year.var[,2]) %>% as_tbl_time(time)
pentad.var <- collapse_by(year.var, period = '5 days')
pentad.var <- pentad.var %>% group_by(time) %>%
summarise(swc = mean(.data[["value"]]))
#in leap years, the last pentad has 6 days
if (nrow(pentad.var) == 74){
pentad.var$swc[73] <- (pentad.var$swc[73]*5 + pentad.var$swc[74])/6
}
pentad.swc <- cbind(pentad.swc,pentad.var$swc)
#set dataframe with all years removing undesireble 74th pentad
pentad.swc.series <- rbind(pentad.swc.series, pentad.var[1:73,])
}
year.var[,1]
f.year <- function(i,day.var,year.var=NULL){
year.var$i <- filter(day.var, day.var$year == i)
return(year.var$i)
}
#define a column of years and get start and end of series
swc$year <- year(swc$time)
beg <- min(swc$year) #year of the series beginning
end <- max(swc$year)
# year.swc <- NULL
#organize years in separated lists
year.swc <- lapply(beg:end,f.year, swc)
# View(year.swc)
n.years <- length(year.swc)
#Collapse data on each year (element of the list) into pentads
pentad.swc <- NULL
pentad.swc.series <- NULL
i = 1
year.var <- year.swc[[i]][1:2]
year.var
year.var <- tibble::tibble(time = as.POSIXct(year.var[,1]),
value = year.var[,2]) %>% as_tbl_time(time)
year.var
et0 <- temperature.mean
et0$et <- 0.0023*radiation_atmosphere$ra*
(temperature.max$max - temperature.min$min)*(temperature.mean$mean + 17.8)
et0 <- et0[,c(1,3)]
plot(et0, type = 'l')
# Function to arrange data in list of years
f.year <- function(i,year.var,day.var){
year.var$i <- filter(day.var, day.var$year == i)
}
et0$time <- as.Date(et0$time)
#define a column of years and reload start and end of series
et0$year <- year(et0$time)
beg <- min(et0$year) #year of the series beginning
end <- max(et0$year)
year.et0 <- NULL
#organize years in separated lists
year.et0 <- lapply(beg:end,f.year, year.et0, et0)
n.years <- length(year.et0)
#Collapse data on each year (element of the list) into pentads
pentad.et0 <- NULL
i = 1
year.var <- year.et0[[i]][1:2]
year.var
year.var
year.var <- year.swc[[i]][1:2]
year.var
year.var
year.var1 <- year.swc[[i]][1:2]
year.var1
class(year.var1)
class(year.var1$time)
et0 <- temperature.mean
et0$et <- 0.0023*radiation_atmosphere$ra*
(temperature.max$max - temperature.min$min)*(temperature.mean$mean + 17.8)
et0 <- et0[,c(1,3)]
plot(et0, type = 'l')
# Function to arrange data in list of years
f.year <- function(i,year.var,day.var){
year.var$i <- filter(day.var, day.var$year == i)
}
et0$time <- as.Date(et0$time)
#define a column of years and reload start and end of series
et0$year <- year(et0$time)
beg <- min(et0$year) #year of the series beginning
end <- max(et0$year)
year.et0 <- NULL
#organize years in separated lists
year.et0 <- lapply(beg:end,f.year, year.et0, et0)
n.years <- length(year.et0)
#Collapse data on each year (element of the list) into pentads
pentad.et0 <- NULL
i = 1
year.var <- year.et0[[i]][1:2]
class(year.var1)
class(year.var1$time)
class(year.var)
et0 <- as.data.frame(et0)
et0$time <- as.Date(et0$time)
#define a column of years and reload start and end of series
et0$year <- year(et0$time)
beg <- min(et0$year) #year of the series beginning
end <- max(et0$year)
year.et0 <- NULL
#organize years in separated lists
year.et0 <- lapply(beg:end,f.year, year.et0, et0)
#Collapse data on each year (element of the list) into pentads
pentad.et0 <- NULL
i = 1
year.var <- year.et0[[i]][1:2]
year.var
year.var <- tibble::tibble(time = as.POSIXct(year.var[,1]),
value = year.var[,2]) %>% as_tbl_time(time)
# get ET0 daily from Hargreaves equation
et0 <- temperature.mean
et0$et <- 0.0023*radiation_atmosphere$ra*
(temperature.max$max - temperature.min$min)*(temperature.mean$mean + 17.8)
et0 <- et0[,c(1,3)]
# Function to arrange data in list of years
f.year <- function(i,year.var,day.var){
year.var$i <- filter(day.var, day.var$year == i)
}
et0$time <- as.Date(et0$time)
#define a column of years and reload start and end of series
et0$year <- year(et0$time)
end <- max(et0$year)
year.et0 <- NULL
#organize years in separated lists
year.et0 <- lapply(beg:end,f.year, year.et0, et0)
#Collapse data on each year (element of the list) into pentads
pentad.et0 <- NULL
i = 1
for (i in 1:n.years){
year.var <- year.et0[[i]][1:2]
year.var <- tibble::tibble(time = as.POSIXct(year.var[,1]),
value = year.var[,2]) %>% as_tbl_time(time)
pentad.var <- collapse_by(year.var, period = '5 days')
pentad.var <- pentad.var %>% group_by(time) %>%
summarise(et0 = mean(.data[["et"]]))
#in leap years, the last pentad has 6 days
if (nrow(pentad.var) == 74){
pentad.var$et0[73] <- (pentad.var$et0[73]*5 + pentad.var$et0[74])/6
}
pentad.et0 <- cbind(pentad.et0,pentad.var$et0)
}
et0 <- as.data.frame(et0)
et0$time <- as.Date(et0$time)
#define a column of years and reload start and end of series
et0$year <- year(et0$time)
beg <- min(et0$year) #year of the series beginning
end <- max(et0$year)
year.et0 <- NULL
#organize years in separated lists
year.et0 <- lapply(beg:end,f.year, year.et0, et0)
n.years <- length(year.et0)
#Collapse data on each year (element of the list) into pentads
pentad.et0 <- NULL
for (i in 1:n.years){
year.var <- year.et0[[i]][1:2]
year.var <- tibble::tibble(time = as.POSIXct(year.var[,1]),
value = year.var[,2]) %>% as_tbl_time(time)
pentad.var <- collapse_by(year.var, period = '5 days')
pentad.var <- pentad.var %>% group_by(time) %>%
summarise(et0 = mean(.data[["et"]]))
#in leap years, the last pentad has 6 days
if (nrow(pentad.var) == 74){
pentad.var$et0[73] <- (pentad.var$et0[73]*5 + pentad.var$et0[74])/6
}
pentad.et0 <- cbind(pentad.et0,pentad.var$et0)
}
year.var
#Collapse data on each year (element of the list) into pentads
pentad.et0 <- NULL
for (i in 1:n.years){
year.var <- year.et0[[i]][1:2]
year.var <- tibble::tibble(time = as.POSIXct(year.var[,1]),
value = year.var[,2]) %>% as_tbl_time(time)
pentad.var <- collapse_by(year.var, period = '5 days')
pentad.var <- pentad.var %>% group_by(time) %>%
summarise(et0 = mean(.data[["value"]]))
#in leap years, the last pentad has 6 days
if (nrow(pentad.var) == 74){
pentad.var$et0[73] <- (pentad.var$et0[73]*5 + pentad.var$et0[74])/6
}
pentad.et0 <- cbind(pentad.et0,pentad.var$et0)
}
precipitation
WD <- "C:/Users/pedro/OneDrive/@DOUTORADO/@@TU-Berlin/@Artigos/CAP 4/R"
setwd(WD)
de.tha <- read.csv('FLX_DE-Tha_FLUXNET2015_SUBSET_HH_1996-2014_1-4.csv')
deficit_ac_sort_week
library(fdClassity2)
remove.packages("fdClassity2", lib="~/R/win-library/4.0")
remove.packages("fdClassify", lib="~/R/win-library/4.0")
install.packages('roxygen2')
install.packages('devtools')
install.packages('roxygen2')
install.packages('devtools')
library(devtools)
library(roxygen2)
