usethis::use_data(de_tha_f)
usethis::use_data(de_tha_h)
load("C:/Users/pedro/OneDrive/@DOUTORADO/@@TU-Berlin/@Artigos/CAP 4/package/fdClassify/data/de_tha_d.rda")
de_tha_h
colmanes(de_tha_h)
colnames(de_tha_h)
colnames(de_tha_d)
library(fdClassify)
fd_FordLabosier <- FordLabosier2017(vtime = de_tha_d$time,
vswc = de_tha_d$soil_water,
crit = c(40,20,30))
Sys.setenv(lang = 'en')
fd_FordLabosier <- FordLabosier2017(vtime = de_tha_d$time,
vswc = de_tha_d$soil_water,
crit = c(40,20,30))
detach("package:fdClassify", unload = TRUE)
library(fdClassify)
fd_FordLabosier <- FordLabosier2017(vtime = de_tha_d$time,
vswc = de_tha_d$soil_water,
crit = c(40,20,30))
a <- date
a
a <- "2020-01-01"
a <- as.Date(a)
a
year(a)
library(lubridate)
year(a)
fd_FordLabosier <- FordLabosier2017(vtime = de_tha_d$time,
vswc = de_tha_d$soil_water,
crit = c(40,20,30))
detach("package:lubridate", unload = TRUE)
detach("package:fdClassify", unload = TRUE)
library(fdClassify)
fd_FordLabosier <- FordLabosier2017(vtime = de_tha_d$time,
vswc = de_tha_d$soil_water,
crit = c(40,20,30))
a <- "2020-01-01"
fd_FordLabosier <- FordLabosier2017(vtime = de_tha_d$time,
vswc = de_tha_d$soil_water,
crit = c(40,20,30))
library(lubridate)
fd_FordLabosier <- FordLabosier2017(vtime = de_tha_d$time,
vswc = de_tha_d$soil_water,
crit = c(40,20,30))
vtime = de_tha_d$time
vswc = de_tha_d$soil_water
crit = c(40,20,30))
crit = c(40,20,30)
crit1 = crit[1] #upper limit
crit2 = crit[2] #lower limit
crit3 = crit[3] # recuperation limit
swc <- data.frame(time = vtime, swc = vswc)
#get pentads
pentad.swc.list <- f.pentad(vtime = swc$time, vvalue = swc$swc,
na_rm = F, f = mean)
series.swc <- pentad.swc.list$pentad_timestamp
pentad.swc <- pentad.swc.list$pentad_matrix
# get percentiles
percentile.swc <- t(apply(pentad.swc,1, f.percentile))
ts.percentile.swc <- ts(c(percentile.swc), frequency = 73, start =  min(year(series.swc$time)))
#get column of percentiles
percentile.series <- c(percentile.swc)
#remove NA from the beggining of the series. Necessary for p.min calculation.
firstNonNA <- min(which(!is.na(percentile.series)))
percentile.series <- percentile.series[firstNonNA:length(percentile.series)]
#get accumulated difference from 1 to 4 pentads.
a1 <- unlist(lapply(1:length(percentile.series),
function(i) percentile.series[i] - percentile.series[i-1])) %>%
c(rep(NA,1),.)
a2 <- unlist(lapply(2:length(percentile.series),
function(i) percentile.series[i] - percentile.series[i-2])) %>%
c(rep(NA,2),.)
library(dplyr)
vtime = de_tha_d$time
vswc = de_tha_d$soil_water
crit = c(40,20,30)
crit1 = crit[1] #upper limit
crit2 = crit[2] #lower limit
crit3 = crit[3] # recuperation limit
swc <- data.frame(time = vtime, swc = vswc)
#get pentads
pentad.swc.list <- f.pentad(vtime = swc$time, vvalue = swc$swc,
na_rm = F, f = mean)
series.swc <- pentad.swc.list$pentad_timestamp
pentad.swc <- pentad.swc.list$pentad_matrix
# get percentiles
percentile.swc <- t(apply(pentad.swc,1, f.percentile))
ts.percentile.swc <- ts(c(percentile.swc), frequency = 73, start =  min(year(series.swc$time)))
# get percentiles
percentile.swc <- t(apply(pentad.swc,1, f.percentile))
swc <- data.frame(time = vtime, swc = vswc)
#get pentads
pentad.swc.list <- f.pentad(vtime = swc$time, vvalue = swc$swc,
na_rm = F, f = mean)
vtime
de_tha_d.csv
de_tha_d <- read.csv('de_tha_d.csv')
de_tha_d
de_tha_d <- de_tha_d[,-c(1)]
de_tha_d
de_tha_d$time <- ymd(de_tha_d$time)
de_tha_d
de_tha_h <- read.csv('de_tha_h.csv')
de_tha_h <- de_tha_h[,-c(1)]
de_tha_h$time <- ymd_hm(de_tha_h$time)
de_tha_h
usethis::use_data(de_tha_d)
usethis::use_data(de_tha_d,overwrite = TRUE)
usethis::use_data(de_tha_h,overwrite = TRUE)
pacman::p_load('ncdf4','ncdf4.helpers','PCICt','ggplot2','tidyr','dplyr','readr'
,'raster','tibbletime','lubridate','RColorBrewer','stringr','knitr'
,'tinytex','data.table','runner','reshape2', 'tidyquant','SPEI'
, 'ggforce','tidyverse','tictoc')
fd_FordLabosier <- FordLabosier2017(vtime = de_tha_d$time,
vswc = de_tha_d$soil_water,
crit = c(40,20,30))
fd_FordLabosier
fd_Mo <- Mo2016(vtime = de_tha_d$time, vprecipitation = de_tha_d$precipitation,
vtemperature = de_tha_d$temperature, vsoil_water = de_tha_d$soil_water,
vlatent_heat = de_tha_d$latent_heat)
detach("package:fdClassify", unload = TRUE)
library(fdClassify)
fd_Mo <- Mo2016(vtime = de_tha_d$time, vprecipitation = de_tha_d$precipitation,
vtemperature = de_tha_d$temperature, vsoil_water = de_tha_d$soil_water,
vlatent_heat = de_tha_d$latent_heat)
library(fdClassify)
fd_Mo <- Mo2016(vtime = de_tha_d$time, vprecipitation = de_tha_d$precipitation,
vtemperature = de_tha_d$temperature, vsoil_water = de_tha_d$soil_water,
vlatent_heat = de_tha_d$latent_heat)
library(fdClassify)
de_tha_d
library(fdClassify)
library(fdClassify)
library(fdClassify)
remove.packages("fdClassify", lib="~/R/win-library/4.0")
install.packages('fdClassify')
install.packages("fdClassify")
library(fdClassify)
if(!require('pacman'))install.packages('pacman')
pacman::p_load('ncdf4','ncdf4.helpers','PCICt','ggplot2','tidyr','dplyr','readr'
,'raster','tibbletime','lubridate','RColorBrewer','stringr','knitr'
,'tinytex','data.table','runner','reshape2', 'tidyquant','SPEI'
, 'ggforce','tidyverse','tictoc')
Sys.setenv(lang = 'en')
fd_FordLabosier <- FordLabosier2017(vtime = de_tha_d$time,
vswc = de_tha_d$soil_water,
crit = c(40,20,30))
fd_Mo <- Mo2016(vtime = de_tha_d$time, vprecipitation = de_tha_d$precipitation,
vtemperature = de_tha_d$temperature, vsoil_water = de_tha_d$soil_water,
vlatent_heat = de_tha_d$latent_heat)
Mo2016
de_tha_d
de_tha_d$time
vtime = de_tha_d$time
vprecipitation = de_tha_d$precipitation
vtemperature = de_tha_d$temperature
vsoil_water = de_tha_d$soil_water
vlatent_heat = de_tha_d$latent_heat
flux_data = T
if (flux_data){
vevap <- actual_evap_day(vtime = vtime, vlatent_heat = vlatent_heat,
vtemperature = vtemperature)
#remove negative values (condensation)
vevap[vevap < 0] <- 0
} else {vevap[vevap < 0] <- 0}
#get dataa into list
list_classification <- list(precipitation = data.frame(time = vtime,
value = vprecipitation),
temperature = data.frame(time = vtime,
value = vtemperature),
soil_water = data.frame(time = vtime,
value = vsoil_water),
actual_evap = data.frame(time = vtime,
value = vevap))
list_classification
vevap
#get dataa into list
list_classification <- list(precipitation = data.frame(time = vtime,
value = vprecipitation),
temperature = data.frame(time = vtime,
value = vtemperature),
soil_water = data.frame(time = vtime,
value = vsoil_water),
actual_evap = data.frame(time = vtime,
value = vevap$eta))
list_classification
list_pentad <- NULL
var_names <- c('precipitation', 'temperature','soil_water', 'actual_evap')
for (i in var_names){
list_pentad[[i]] <- f.pentad(vtime = list_classification[[i]]$time,
vvalue = list_classification[[i]]$value)
}
list_pentad
detach("package:fdClassify", unload = TRUE)
library(fdClassify)
fd_Mo <- Mo2016
Mo2016
library(fdClassify)
library(fdClassify)
library(fdClassify)
library(fdClassify)
aux_year <- lubridate::year
library(fdClassify)
esr_pentad <- f.pentad(vtime = data_et$time, vvalue = data_et$esr, na_rm = T)
library(fdClassify)
library(fdClassify)
#load required packages
library('tidyr')
library('tidyr')
library('dplyr')
library('readr')
library('tibbletime')
library('lubridate')
library('stringr')
library('runner')
library(fdClassify)
library(fdClassify)
library(fdClassify)
library(fdClassify)
Sys.setenv(lang - 'en')
Sys.setenv(lang = 'en')
library(fdClassify)
library(fdClassify)
n <- 29
empiric_p <- 1:n %>% (. -0.33)/(n+0.3333)
#load required packages
library('tidyr')
library('dplyr')
library('readr')
library('tibbletime')
library('lubridate')
library('stringr')
library('runner')
empiric_p <- 1:n %>% (. -0.33)/(n+0.3333)
empiric_p <- (1:n -0.33)/(n+0.3333)
empiric_p
empiric_p <- (1:n -0.33)/(n+0.33)
empiric_p
n <- 36
empiric_p <- (1:n -0.33)/(n+0.33)
empiric_p
vet0 <- (runif(36))
vet0
vet0 <- (runif(36))*10
vet0_sort <- sort(vet0)
seed(36)
set.seed(36)
vet0 <- (runif(36))*10
vet0
vet0 <- (runif(36))*10
vet0
set.seed(36)
vet0 <- (runif(36))*10
vet0 <- (runif(36))*10
set.seed(36)
vet0 <- (runif(36))*10
vet0
vet0_sort <- sort(vet0)
n <- lenght(vet0)
n <- 36
param <- c(2.515517,
0.802853,
0.010328,
1.432788,
0.189269,
0.001308)
param
sqrt
set.seed(36)
vet0 <- (runif(36))*10
vet0_sort <- sort(vet0)
n <- lenght(vet0)
empiric_p <- (1:n -0.33)/(n+0.33)
param <- data.frame(c0 = 2.515517,
c1 = 0.802853,
c2 = 0.010328,
d1 = 1.432788,
d2 = 0.189269,
d3 = 0.001308)
W <- sqrt(-2*log(empiric_p))*(empiric_p <= 0.5) +
sqrt(-2*log(1-empiric_p))*(empiric_p > 0.5)
W
eddi <- W - (param$c0 + param$c1*W + param$c2*W^2)*
(1 + param$d1*W  + param$d2*W^2 + param$d3*W^3)
eddi
eddi <- W - (param$c0 + param$c1*W + param$c2*W^2)*
(1 + param$d1*W  + param$d2*W^2 + param$d3*W^3)^-1
eddi
W <- sqrt(-2*log(empiric_p))*(empiric_p <= 0.5) -
sqrt(-2*log(1-empiric_p))*(empiric_p > 0.5)
eddi <- W - (param$c0 + param$c1*W + param$c2*W^2)*
(1 + param$d1*W  + param$d2*W^2 + param$d3*W^3)^-1
eddi
W <- sqrt(-2*log(empiric_p))*(empiric_p <= 0.5) +
sqrt(-2*log(1-empiric_p))*(empiric_p > 0.5)
(2*(empiric_p <=0.5) - 1)
2*(empiric_p >0.5) - 1)
2*(empiric_p >0.5) - 1
eddi <- eddi*(2*(empiric_p >0.5) - 1)
eddi
W <- sqrt(-2*log(empiric_p))*(empiric_p <= 0.5) +
sqrt(-2*log(1-empiric_p))*(empiric_p > 0.5)
eddi <- W - (param$c0 + param$c1*W + param$c2*W^2)*
(1 + param$d1*W  + param$d2*W^2 + param$d3*W^3)^-1
eddi <- eddi*(2*(empiric_p >0.5) - 1)
eddi
eddi <- (W - (param$c0 + param$c1*W + param$c2*W^2)*
(1 + param$d1*W  + param$d2*W^2 + param$d3*W^3)^-1)*(2*(empiric_p >0.5) - 1)
eddi
order(vet0)
veddi <- eddi[with(order(vet0))]
Sys.setenv(lang = 'en')
veddi <- eddi[with(order(vet0))]
with(order(vet0))
eddi
veddi <- eddi[order(vet0)]
veddi
order(vet0)
plot(sort(vet0), empiric_p)
vte0 <- rnorm(36, mean = 8, sd = 2)
vet0 <- rnorm(36, mean = 8, sd = 2)
vet0
plot(sort(vet0), empiric_p)
library(fdClassify)
WD <- "C:/Users/pedro/OneDrive/@DOUTORADO/@@TU-Berlin/@Artigos/CAP 4/R"
setwd(WD)
de.tha <- read.csv('FLX_DE-Tha_FLUXNET2015_SUBSET_DD_1996-2014_1-4.csv')
df <- de.tha
data_et <- df[,c('TIMESTAMP','WS_F','TA_F', 'H_F_MDS', 'LE_F_MDS', 'VPD_F')]
write.csv(data_et,'de_tha_et.csv')
data_et$TIMESTAMP <- ymd(data_et$TIMESTAMP)
data_et <- na_if(data_et,-9999)
colnames(data_et) <- c('time', 'wind_speed', 'temperature', 'sensible_heat', 'latent_heat', 'vapor_p_def')
et0 <- penman_day(v.time = data_et$time, v.wind = data_et$wind_speed,
v.temp = data_et$temperature, v.vpd =data_et$vapor_p_def,
v.heatflux = data_et$heat_flux)
data_et$vapor_p_def <- 0.1*data_et$vapor_p_def
data_et$heat_flux <- (data_et$sensible_heat +
data_et$latent_heat)/86.4
et0 <- penman_day(v.time = data_et$time, v.wind = data_et$wind_speed,
v.temp = data_et$temperature, v.vpd =data_et$vapor_p_def,
v.heatflux = data_et$heat_flux)
WD <- "C:/Users/pedro/OneDrive/@DOUTORADO/@@TU-Berlin/@Artigos/CAP 4/R"
setwd(WD)
de.tha <- read.csv('FLX_DE-Tha_FLUXNET2015_SUBSET_DD_1996-2014_1-4.csv')
df <- de.tha
data_et <- df[,c('TIMESTAMP','WS_F','TA_F', 'H_F_MDS', 'LE_F_MDS', 'VPD_F')]
write.csv(data_et,'de_tha_et.csv')
data_et$TIMESTAMP <- ymd(data_et$TIMESTAMP)
data_et <- na_if(data_et,-9999)
colnames(data_et) <- c('time', 'wind_speed', 'temperature', 'sensible_heat', 'latent_heat', 'vapor_p_def')
data_et$vapor_p_def <- 0.1*data_et$vapor_p_def
data_et$heat_flux <- (data_et$sensible_heat +
data_et$latent_heat)/86.4
et0 <- penman_day(v.time = data_et$time, v.wind = data_et$wind_speed,
v.temp = data_et$temperature, v.vpd =data_et$vapor_p_def,
v.heatflux = data_et$heat_flux)
Sys.setenv(lang = 'en')
et0 <- penman_day(v.time = data_et$time, v.wind = data_et$wind_speed,
v.temp = data_et$temperature, v.vpd =data_et$vapor_p_def,
v.heatflux = data_et$heat_flux)
data_et
et0
et0 <- penman_day(v.time = data_et$time, v.wind = data_et$wind_speed,
v.temp = data_et$temperature, v.vpd =data_et$vapor_p_def,
v.heatflux = data_et$heat_flux)
penman_day
et0 <- penman_day(vtime = data_et$time, vwind = data_et$wind_speed,
vtemp = data_et$temperature, vvpd =data_et$vapor_p_def,
vheatflux = data_et$heat_flux)
et0
#get weeks
et0$time <- as.Date(et0$time)
week.et0.list <- f.week(et0)
series.et0 <- week.et0.list$week_timestamp
week.et0 <- week.et0.list$week_matrix
# get percentiles
eddi.et0 <- t(apply(week.et0,1, eddi))
n <- length(vet0)
eddi <- function(vet0){
n <- length(vet0)
empiric_p <- (1:n -0.33)/(n+0.33) #empiric probabilities (Tukey plotting)
param <- data.frame(c0 = 2.515517,
c1 = 0.802853,
c2 = 0.010328,
d1 = 1.432788,
d2 = 0.189269,
d3 = 0.001308)
W <- sqrt(-2*log(empiric_p))*(empiric_p <= 0.5) +
sqrt(-2*log(1-empiric_p))*(empiric_p > 0.5)
eddi <- (W - (param$c0 + param$c1*W + param$c2*W^2)*
(1 + param$d1*W  + param$d2*W^2 + param$d3*W^3)^-1)*(2*(empiric_p >0.5) - 1)
veddi <- eddi[order(vet0)] # reorder to match input data
return(veddi)
}
library(fdClassify)
Sys.setenv(lang = 'en')
WD <- "C:/Users/pedro/OneDrive/@DOUTORADO/@@TU-Berlin/@Artigos/CAP 4/R"
setwd(WD)
de.tha <- read.csv('FLX_DE-Tha_FLUXNET2015_SUBSET_DD_1996-2014_1-4.csv')
df <- de.tha
data_et <- df[,c('TIMESTAMP','WS_F','TA_F', 'H_F_MDS', 'LE_F_MDS', 'VPD_F')]
write.csv(data_et,'de_tha_et.csv')
data_et$TIMESTAMP <- ymd(data_et$TIMESTAMP)
data_et <- na_if(data_et,-9999)
colnames(data_et) <- c('time', 'wind_speed', 'temperature', 'sensible_heat', 'latent_heat', 'vapor_p_def')
data_et$vapor_p_def <- 0.1*data_et$vapor_p_def
data_et$heat_flux <- (data_et$sensible_heat +
data_et$latent_heat)/86.4
et0 <- penman_day(vtime = data_et$time, vwind = data_et$wind_speed,
vtemp = data_et$temperature, vvpd =data_et$vapor_p_def,
vheatflux = data_et$heat_flux)
#load required packages
library('tidyr')
library('dplyr')
library('readr')
library('tibbletime')
library('lubridate')
library('stringr')
library('runner')
#get weeks
et0$time <- as.Date(et0$time)
week.et0.list <- f.week(et0)
series.et0 <- week.et0.list$week_timestamp
week.et0 <- week.et0.list$week_matrix
# get percentiles
eddi.et0 <- t(apply(week.et0,1, eddi))
eddi.et0
data.table <- data.frame(time = as.Date(series.et0$time),
eddi = c(eddi.et0),
et0 = c(week.et0))
data.table$dif_eddi <- append(NA,as.vector(diff(data.table$eddi,
lag = 1)))
empiric_p
veddi <- empiric_p[order(vet0)]*100
veddi
veddi <- round(empiric_p[order(vet0)]*100)
veddi
sort(veddi)
library(fdClassify)
wd
getwd()
library(fdClassify)
timestep <- 'day'
(timestep %in% set_day)
set_day <- c('day', 'daily')
set_hour <- c('hour', 'hourly', 'sub-daily', 'subdaily')
(timestep %in% set_day)
timestep <- 'd'
(timestep %in% set_day)
timestep <- 'Day'
(timestep %in% set_day)
(tolower(timestep) %in% set_day)
timestep <- 'Day'
(tolower(timestep) %in% set_day)
getwd()
set_hour <- c('hour', 'hourly', 'sub-daily', 'subdaily', 'h', 'half-hour', 'half', 'halfhour',
'half hour', '30 min', '30-min', '30', 30)
set_hour
set_hour <- c('hour', 'hourly', 'sub-daily', 'subdaily', 'h', 'half-hour', 'half', 'halfhour',
'half hour', '30 min', '30-min', '30', as.numeric(30))
set_hour
library(fdClassify)
library(fdClassify)
library(fdClassify)
source('C:/Users/pedro/OneDrive/@DOUTORADO/@@TU-Berlin/@Artigos/CAP 4/package/fdClassify/R/df_fluxnet.R', echo=TRUE)
library(fdClassify)
library(fdClassify)
library(fdClassify)
library(fdClassify)
library(fdClassify)
devtools::load_all(".")
library(fdClassify)
library(fdClassify)
library(fdClassify)
library(fdClassify)
library(fdClassify)
import(ggplot2)
library(fdClassify)
library(fdClassify)
library(fdClassify)
library(fdClassify)
library(fdClassify)
library(fdClassify)
library(fdClassify)
library(fdClassify)
library(fdClassify)
library(fdClassify)
library(fdClassify)
library(fdClassify)
library(fdClassify)
library(fdClassify)
library(fdClassify)
library(fdClassify)
library(fdClassify)
library(fdClassify)
library(fdClassify)
library(fdClassify)
library(fdClassify)
library(fdClassify)
library(fdClassify)
library(fdClassify)
library(fdClassify)
library(fdClassify)
library(fdClassify)
library(fdClassify)
library(fdClassify)
library(fdClassify)
library(fdClassify)
Mo2016
install.packages('plotrix')
